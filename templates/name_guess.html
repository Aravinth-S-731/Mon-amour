<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Guess Me??</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/name_guess.css') }}" />
</head>
<body>

    <a href="{{ url_for('logout') }}" class="visit-later-btn">ðŸ”’ Visit Later</a>

    <div class="floating-wrapper">
        <div class="floating-flex">
            <div class="floating-text">
                <div class="memory-line left">Maybe I was your classmate... ðŸ“˜</div>
                <div class="memory-line right">Maybe we crossed paths in a library... ðŸ“š</div>
                <div class="memory-line left">Or waited beside you while it rained... â˜”</div>
                <div class="memory-line right">We mightâ€™ve worked together... or just exchanged a smile ðŸ’¼</div>
                <div class="memory-line center">Or maybe... weâ€™ve never met at all... ðŸ‘€</div>
                <p class="emphasis">And yet... something feels familiar, doesnâ€™t it?</p>
                <p class="memory-line right">See right ðŸ˜Š âž¯</p>
            </div>

            <!-- Right Side Form -->
            <div class="form-card">
                <h2>So... who do you *think* I am? ðŸ’­</h2>
                <form action="{{ url_for('name_guess') }}" method="POST">
                    {% set attempts = session.get("name_guess_attempts", 0) %}

                    {% if attempts == 0 %}
                        <!-- Attempt 1: Single Input -->
                        <input type="text" name="guessed_name" placeholder="Type the name that's in your heart..." required />

                    {% elif attempts == 1 %}
                        <!-- Attempt 2: OTP-style empty inputs -->
                        <div class="letter-inputs">
                            {% set name = "aravinth" %}
                            {% for i in range(1, name|length + 1) %}
                                <input type="text" maxlength="1" name="char{{ i }}" required />
                            {% endfor %}
                        </div>

                    {% elif attempts == 2 %}
                        <!-- Attempt 3: OTP-style with auto-filled letters -->
                        <div class="letter-inputs">
                            {% set name = "ARAVINTH" %}
                            {% for i in range(1, name|length + 1) %}
                                {% if i in [1, 8] %}
                                    <input type="text" maxlength="1" name="char{{ i }}" value="{{ name[i-1] }}" readonly />
                                {% else %}
                                    <input type="text" maxlength="1" name="char{{ i }}" required />
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}

                    <button type="submit">Reveal the mystery ðŸ’Œ</button>

                    {% if error %}
                        <p class="error">{{ error }}</p>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>

    <script>
        window.addEventListener("load", () => {
            document.body.style.visibility = "visible";
            document.body.style.opacity = "1";

            // Auto-focus to next field for OTP-style input
            const inputs = document.querySelectorAll('.letter-inputs input');
            inputs.forEach((input, idx) => {
                input.addEventListener('input', () => {
                if (input.value.length === 1 && idx < inputs.length - 1) {
                    inputs[idx + 1].focus();
                }
                });
            });
        });
    </script>

</body>
</html>
